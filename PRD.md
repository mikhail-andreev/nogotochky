# PRD - Платформа онлайн-записи на услуги (MVP)

## Краткое описание
Платформа для онлайн-записи клиентов к мастерам (салоны красоты, частные мастера, клиники). В MVP три интерфейса:
- Витрина (публичная страница для записи).
- Кабинет мастера (настройка услуг/расписания, просмотр записей).
- Админ-панель (управление всем).

## Глоссарий
- Бизнес-клиент: салон/клиника/частный мастер — тот, кто в будущем платит за сервис.
- Посетитель: клиент, который заходит на витрину и создает запись.
- Мастер: пользователь системы, который оказывает услуги и управляет своим расписанием.

## Цели MVP
- Посетитель может создать запись к мастеру через витрину, оставив контактные данные.
- Мастер может сам зарегистрироваться, заполнить профиль, добавить услуги/цены и настроить доступность.
- Мастер видит список записей и контакты посетителей.
- Администратор видит и управляет всеми ключевыми сущностями.

## Ограничения MVP
- Контакты посетителя не проверяются (нет SMS/Email подтверждения).
- Нет платежей/подписок/биллинга.
- Нет внешних интеграций (календарь, мессенджеры, SMS-шлюзы).

## Объем MVP
### Витрина

- Каталог мастеров (`/masters/`) — показывает мастеров с доступными слотами в ближайшие 2 недели, а также полный список всех мастеров.
- Публичная страница мастера (с привязкой к карточке салона/клиники, если указано).
- Список услуг мастера (название, длительность, цена).
- Отображение доступных слотов (ближайшие 2 недели, без ручного фильтра по датам).
- Создание записи: имя + телефон (+ опционально комментарий).

### Кабинет мастера
- Регистрация и вход.
- Профиль мастера.
- Карточка салона/клиники (в MVP: у мастера одна карточка салона).
- Управление услугами (CRUD) и ценами.
- Управление доступностью (создание/удаление слотов либо настройка расписания с генерацией слотов).
- Просмотр записей: дата/время, услуга, имя/телефон, статус.

### Админ-панель
- Просмотр и управление мастерами, салонами, услугами, слотами и записями.
- Блокировка/разблокировка мастеров/салонов.

## Основные сущности (продуктовый уровень)
- Мастер (аккаунт + профиль).
- Салон/клиника (карточка организации для витрины).
- Услуга.
- Слот доступности.
- Запись.

## Основные сценарии
### Создание записи (посетитель)

1. Открывает каталог мастеров.
2. Выбирает мастера.
3. Выбирает услугу.
4. Выбирает доступный слот (ближайшие 2 недели).
5. Вводит имя и телефон.
6. Видит подтверждение, что запись создана.

### Настройка профиля и расписания (мастер)
1. Регистрируется и входит.
2. Заполняет профиль и карточку салона.
3. Добавляет услуги.
4. Настраивает слоты доступности.
5. Получает записи и видит контакты посетителей.

### Управление (админ)
1. Входит.
2. Ищет/фильтрует мастеров, салоны, услуги, записи.
3. При необходимости блокирует сущности или исправляет данные.

## Функциональные требования
- Нельзя создать две записи на один и тот же слот.
- Данные записей доступны только соответствующему мастеру и администраторам.
- Витрина публична и не требует входа.

## Нефункциональные требования и тех. ограничения MVP
- Dev-среда разворачивается через `docker compose`.
- Бэкенд реализован на Django.
- База данных на этапе MVP: SQLite.
- Пароли хранятся безопасно (хэширование).

## Принятые решения (MVP)
- **Фронтенд**: Django templates (server-side rendering) — быстрее для MVP, без необходимости отдельных SPA.
- **Админ-панель**: встроенный Django Admin.
- **Объединение слотов**: если услуга длиннее одного слота, система автоматически объединяет несколько последовательных свободных слотов.
- **URL витрины мастера**: человекочитаемый slug (например, `/masters/anna-nails`).
- **Порт**: 8000 (стандартный Django).

## Критерии приемки MVP
- Посетитель может создать запись без верификации контактов.
- Мастер может зарегистрироваться, добавить карточку салона, услуги и слоты.
- Мастер видит список записей и контактные данные посетителей.
- Администратор может просматривать и управлять ключевыми сущностями.

## Реализованный пользовательский путь (витрина)

1. Каталог мастеров (`/masters/`) — выбор мастера.
2. Страница мастера (`/masters/{slug}/`) — просмотр профиля и выбор услуги.
3. Выбор времени (`/masters/{slug}/slots/?service=N`) — доступные слоты на ближайшие 2 недели.
4. Форма записи (`/masters/{slug}/book/`) — ввод имени и телефона.
5. Подтверждение (`/masters/{slug}/book/success/`).

## Тестовое покрытие

72 автотеста (Django TestCase), покрывающие все 4 приложения:

- **accounts** (14): User модель, роли, регистрация, логин/логаут, сигнал создания профиля.
- **masters** (18): MasterProfile, Salon, Service, MasterRequiredMixin, CRUD views, изоляция данных.
- **schedule** (16): ScheduleSlot, Booking, отмена (включая мульти-слот), SlotCreateForm, views.
- **showcase** (24): каталог мастеров, фильтрация слотов, бронирование (одинарное и мульти-слот), граничные случаи.

## Открытые вопросы (после MVP)

- Несколько мастеров в одном салоне и модель прав доступа.
- Локализация/часовые пояса/региональные требования.
